(function(g,d){g.Exploder=function(a,b){this.options=d.extend({},this.options,b);this.alpha=this.options.startingAlpha;var e=this.options.pointColor.replace(/#/,"");this.pointColor=[parseInt(e.substr(0,2),16),parseInt(e.substr(2,2),16),parseInt(e.substr(4,2),16)];this.colorDifference=this.colorDiff(this.options.destinationColor,this.pointColor);this.body=d("body");this.source=a};g.Exploder.prototype={options:{duration:1,pointRadius:1,radiusVariation:5,seeds:500,startingPositionVariation:1,incrementVariation:2,
pointColor:"#333333",startingAlpha:255,alphaDelay:0.5,alphaIncrement:15,xVariation:1.5,yVariation:1,destroySource:!0,width:200,height:200,onExplodeFinished:null,destinationColor:[255,255,255]},colorDiff:function(a,b){return[a[0]-b[0],a[1]-b[1],a[2]-b[2]]},colorSum:function(a,b){return[a[0]+b[0],a[1]+b[1],a[2]+b[2]]},colorMult:function(a,b){return[a*b[0],a*b[1],a*b[2]]},explode:function(){this.canvas=d("<canvas></canvas>");this.canvas.css("position","absolute");this.canvas.width(this.options.width);
this.canvas.height(this.options.height);this.body.append(this.canvas);var a=this.source.offset();a.left-=this.options.width/2;a.left+=this.source.width()/2;a.top-=this.canvas.height()/2;a.top+=this.source.height()/2;this.canvas.offset(a);this.processing=new Processing(this.canvas[0],this.doExplode.bind(this))},doExplode:function(a){this.options.destroySource&&this.source.remove();a.size(this.options.width,this.options.height);a.background(255,0);var b=this.options.width/2-this.options.pointRadius,
e=this.options.height/2-this.options.pointRadius,d=[];for(i=0;i<this.options.seeds;++i){var g=b,k=e,c=2*Math.random()*Math.PI,f=Math.sin(c)*this.options.incrementVariation,c=Math.cos(c)*this.options.incrementVariation,f=f+(2*Math.random()*this.options.incrementVariation-this.options.incrementVariation),c=c+(2*Math.random()*this.options.incrementVariation-this.options.incrementVariation),f=f*this.options.xVariation,c=c*this.options.yVariation,h=Math.random(),h=this.colorSum(this.pointColor,this.colorMult(h,
this.colorDifference)),l=2*this.options.pointRadius+Math.random()*this.options.radiusVariation;d.push({x:g,y:k,xInc:f,yInc:c,color:h,size:l})}var j=0;a.draw=function(){j+=1/60*this.options.alphaDelay;a.background(255,0);j>this.options.alphaDelay&&(0<this.alpha?this.alpha-=this.options.alphaIncrement:this.finishExplode());a.noStroke();for(i=0;i<d.length;++i){var b=d[i];a.fill(b.color[0],b.color[1],b.color[2],this.alpha);a.ellipse(b.x,b.y,b.size,b.size);var c=1/Math.log(b.xInc),e=1/Math.log(b.yInc);
b.x+=c;b.y+=e}}.bind(this)},finishExplode:function(){this.canvas.remove();this.processing.exit();if(this.options.onExplodeFinished)this.options.onExplodeFinished()}}})(window,jQuery);
