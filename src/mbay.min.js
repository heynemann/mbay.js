(function(g,f){g.Exploder=function(a,c){this.options=f.extend({},this.options,c);this.alpha=this.options.startingAlpha;this.setPointColor(this.options.pointColor);this.body=f("body");this.source=a};g.Exploder.prototype={options:{speed:1,alphaSpeed:1,pointRadius:1,radiusVariation:5,seeds:500,startingPositionVariation:1,pointColor:"#333333",startingAlpha:255,alphaDelay:0.5,xVariation:1.5,yVariation:1,destroySource:!0,width:200,height:200,onExplodeFinished:null,destinationColor:[255,255,255],minAlpha:0},
colorDiff:function(a,c){return[a[0]-c[0],a[1]-c[1],a[2]-c[2]]},colorSum:function(a,c){return[a[0]+c[0],a[1]+c[1],a[2]+c[2]]},colorMult:function(a,c){return[a*c[0],a*c[1],a*c[2]]},setPointColor:function(a){a=a.replace(/#/,"");this.pointColor=[parseInt(a.substr(0,2),16),parseInt(a.substr(2,2),16),parseInt(a.substr(4,2),16)];this.colorDifference=this.colorDiff(this.options.destinationColor,this.pointColor)},explode:function(){this.canvas=f("<canvas></canvas>");this.canvas.css("position","absolute");
this.canvas.width(this.options.width);this.canvas.height(this.options.height);this.body.append(this.canvas);var a=this.source.offset();a.left-=this.options.width/2;a.left+=this.source.width()/2;a.top-=this.canvas.height()/2;a.top+=this.source.height()/2;this.canvas.offset(a);this.processing=new Processing(this.canvas[0],this.doExplode.bind(this))},doExplode:function(a){this.options.destroySource&&this.source.remove();a.size(this.options.width,this.options.height);a.background(255,0);var c=this.options.width/
2-this.options.pointRadius,f=this.options.height/2-this.options.pointRadius,h=[];for(i=0;i<this.options.seeds;++i){var g=c,l=f,d=2*Math.random()*Math.PI,e=Math.sin(d)*this.options.speed,d=Math.cos(d)*this.options.speed,e=e+(2*Math.random()*this.options.speed-this.options.speed),d=d+(2*Math.random()*this.options.speed-this.options.speed),e=e*this.options.xVariation,d=d*this.options.yVariation,j=Math.random(),j=this.colorSum(this.pointColor,this.colorMult(j,this.colorDifference)),m=2*this.options.pointRadius+
Math.random()*this.options.radiusVariation;h.push({x:g,y:l,xInc:e,yInc:d,color:j,size:m,xOffset:0<e?-1:1,yOffset:0<d?-1:1})}var k=0;a.draw=function(){k+=1/60;a.background(255,0);k>this.options.alphaDelay&&(this.alpha>this.options.minAlpha?this.alpha-=this.options.alphaSpeed:this.finishExplode());a.noStroke();for(i=0;i<h.length;++i){var b=h[i];a.fill(b.color[0],b.color[1],b.color[2],this.alpha);a.ellipse(b.x,b.y,b.size,b.size);var c=b.yInc*this.options.speed/60;b.x+=b.xInc*this.options.speed/60;b.y+=
c;b.xInc+=0.05*b.xOffset;b.yInc+=0.05*b.yOffset}}.bind(this)},finishExplode:function(){this.canvas.remove();this.processing.exit();if(this.options.onExplodeFinished)this.options.onExplodeFinished()}}})(window,jQuery);
